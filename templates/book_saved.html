{% extends "base.html" %}
{% block title %}Saved Books - Dashboard{% endblock %}
{% block mobile_title %}Saved Books{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-bookmark-star"></i> Saved Books</h2>
    <span class="text-muted">{{ books|length }}ê¶Œ</span>
</div>

{% if books %}
<div class="row row-cols-1 row-cols-md-2 g-3" id="saved-list">
    {% for book in books %}
    <div class="col" id="saved-{{ book.id }}">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0">{{ book.title }}</h5>
                    {% if book.category %}
                    <span class="badge bg-info text-dark ms-2" style="white-space: nowrap;">{{ book.category }}</span>
                    {% endif %}
                </div>
                <h6 class="card-subtitle text-muted mb-2">{{ book.author }}</h6>
                {% if book.reason %}
                <p class="card-text" style="font-size: 0.9rem;">{{ book.reason }}</p>
                {% endif %}
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <small class="text-muted">
                        {{ book.saved_at.strftime('%Y-%m-%d') }}
                    </small>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="addToReading({{ book.id }}, this)">
                            ğŸ“– ì§€ê¸ˆ ì½ëŠ” ì¤‘ ë“±ë¡
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeSaved({{ book.id }})">
                            <i class="bi bi-trash"></i> ì œê±°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center text-muted py-5">
    <i class="bi bi-bookmark" style="font-size: 3rem;"></i>
    <p class="mt-2">ì°œí•œ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    <p style="font-size: 0.9rem;">
        <a href="{{ url_for('book_recommendations') }}">AI Book Advisor</a>ì—ì„œ ì¶”ì²œë°›ì€ ì±…ì„ ì°œí•´ ë³´ì„¸ìš”.
    </p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
async function removeSaved(id) {
    try {
        const resp = await fetch(`/api/books/saved/${id}`, {method: 'DELETE'});
        if (resp.ok) {
            const el = document.getElementById('saved-' + id);
            if (el) {
                el.style.transition = 'opacity 0.3s';
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 300);
            }
        }
    } catch (err) {
        console.error('Remove failed:', err);
    }
}

async function addToReading(id, btn) {
    btn.disabled = true;
    btn.textContent = 'ë“±ë¡ ì¤‘...';
    const res = await fetch(`/api/books/saved/${id}/to-reading`, { method: 'POST' });
    if (res.ok) {
        btn.textContent = 'âœ“ ë“±ë¡ë¨';
        btn.classList.add('registered');
    } else {
        btn.textContent = 'ì˜¤ë¥˜';
        btn.disabled = false;
    }
}
</script>
{% endblock %}
